<link rel="import" href="../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<dom-module id="labrad-exception-handler">
  <style>
    :host {
      display: table-row;
    }
    td {
      font-family: "Roboto Regular", sans-serif;
      font-size: 14px;
      padding: 7px;
      color: #F44336;
      font-weight: 800;
      background-color: #fff;
      border-top: 2px solid #f44336;
    }
    div.exceptionCollapse {
      padding: 5px 15px;
      word-wrap: wrap;
      font-size: 13px;
      font-weight: 400;
    }
    div.exceptionCollapse span {
      font-weight: 800;
    }
    div.exception {
      padding: 10px;
      font-size: 12px;
      font-weight: 400;
    }
    paper-button.dismiss {
      float: right;
    }
  </style>
  <template>
    <template is="dom-if" if="{{error}}">
      <td colspan="999">
        {{error}}
        <paper-button class='dismiss' on-click="dismissException">Dismiss</paper-button>

        <div class="exceptionCollapse">
          <div>
            <span>Exception</span>
            <paper-button on-click="toggleException">Show/Hide</paper-button>
          </div>
          <iron-collapse id="exceptionCollapse">
            <div class='exception'>{{exception}}</div>
          </iron-collapse>
        </div>
      </td>
    </template>
  </template>
</dom-module>

<dom-module id="labrad-instance-controller">
  <style>
    .divider {
      font-weight: bold;
    }
    td {
      padding: 2px 5px 2px 5px;
    }
    paper-icon-button {
      width: 1.6em;
      height: 1.6em;
      padding: 0px;
    }
    paper-spinner {
      width: 18px;
      height: 18px;
      top: 5px;
    }
  </style>
  <template>
    <div>
      <!-- states: stopped, starting, started, stopping -->
      <!-- <span>{{status}}</span> -->
      <a is="app-link" path="{{serverUrl}}" href="{{serverUrl}}">
        <paper-icon-button id="info" icon="info"></paper-icon-button></a>

      <span hidden$="{{!active}}">
        <paper-spinner active></paper-spinner>
      </span>

      <span hidden$="{{active}}">
        <paper-icon-button id="start" icon="av:play-arrow"></paper-icon-button>
        <paper-icon-button id="stop" icon="av:stop"></paper-icon-button>
        <paper-icon-button id="restart" icon="av:replay"></paper-icon-button>
      </span>
    </div>
  </template>
</dom-module>

<dom-module id="labrad-node-controller">
  <style>
    paper-icon-button {
      width: 1.6em;
      height: 1.6em;
      padding: 0px;
    }
    paper-spinner {
      width: 18px;
      height: 18px;
      top: 5px;
    }
  </style>
  <template>
    <span>{{name}}</span>

    <span hidden$="{{!active}}">
      <paper-spinner active></paper-spinner>
    </span>

    <span hidden$="{{active}}">
      <paper-icon-button id="refresh" icon="av:replay"></paper-icon-button>
    </span>
  </template>
</dom-module>

<dom-module id="labrad-nodes">
  <style>
    :host {
      display: block;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th {
      padding: 4px;
    }
    td {
      padding: 4px;
    }
    thead tr {
      background-color: #440088;
      color: white;
    }
    tbody tr:nth-of-type(odd) {
      background-color: #EEEEEE;
    }
    tbody tr:nth-of-type(odd):hover {
      background-color: #F6F699;
    }
    tbody tr:nth-of-type(even):hover {
      background-color: #FFFFAA;
    }
    td.name {
      padding-left: 10px;
    }
    td.version {
      width: 150px;
    }
    td.controls {
      width: 350px;
    }
  </style>
  <template>
    <div>
      <table>
        <thead>
          <th>Global Servers</th>
          <th></th>
          <template is="dom-repeat" items="{{nodeNames}}" as="node">
            <th><labrad-node-controller places={{places}} api={{api}} name={{node}}></labrad-node-controller></th>
          </template>
        </thead>
        <tbody>
          <template is="dom-repeat" items="{{globalServers}}" as="server">
            <tr>
              <td class='name'>{{server.name}}</td>
              <td class='version'>{{server.version}}</td>
              <template is="dom-repeat" items="{{server.nodes}}" as="node">
                <td class='controls'>
                  <template is="dom-if" if="{{node.exists}}">
                    <labrad-instance-controller
                      places={{places}}
                      api={{api}}
                      local
                      name={{server.name}}
                      server={{server}}
                      instance-name={{node.instanceName}}
                      node={{node.name}}
                      status={{node.status}} />
                  </template>
                </td>
              </template>
            </tr>
            <labrad-exception-handler
              error="{{server.errorString}}"
              exception="{{server.errorException}}" />
          </template>
        </tbody>

        <thead>
          <th>Local Servers</th>
          <th></th>
          <template is="dom-repeat" items="{{nodeNames}}">
            <th></th>
          </template>
        </thead>
        <tbody>
          <template is="dom-repeat" items="{{localServers}}" as="server">
            <tr>
              <td class='name'>{{server.name}}</td>
              <td class='version'>{{server.version}}</td>
              <template is="dom-repeat" items="{{server.nodes}}" as="node">
                <td class='controls'>
                  <template is="dom-if" if="{{node.exists}}">
                    <labrad-instance-controller
                      places={{places}}
                      api={{api}}
                      name={{server.name}}
                      server={{server}}
                      instance-name={{node.instanceName}}
                      node={{node.name}}
                      status={{node.status}} />
                  </template>
                </td>
              </template>
            </tr>
            <labrad-exception-handler
              error="{{server.errorString}}"
              exception="{{server.errorException}}" />
          </template>
        </tbody>
      </table>
    </div>
  </template>
</dom-module>
