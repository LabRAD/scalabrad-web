<dom-module id="expandable-input">
  <template>
    <iron-a11y-keys keys="enter" on-keys-pressed="submitForm">

     <!--   <input is="iron-input" id="input"
          aria-labelledby$="[[_ariaLabelledBy]]"
          aria-describedby$="[[_ariaDescribedBy]]"
          disabled$="[[disabled]]"
          bind-value="{{value_short}}"
          invalid="{{invalid}}"
          prevent-invalid-input="[[preventInvalidInput]]"
          allowed-pattern="[[allowedPattern]]"
          validator="[[validator]]"
          type$="[[type]]"
          pattern$="[[pattern]]"
          required$="[[required]]"
          autocomplete$="[[autocomplete]]"
          autofocus$="[[autofocus]]"
          inputmode$="[[inputmode]]"
          minlength$="[[minlength]]"
          maxlength$="[[maxlength]]"
          min$="[[min]]"
          max$="[[max]]"
          step$="[[step]]"
          name$="[[name]]"
          placeholder$="[[placeholder]]"
          readonly$="[[readonly]]"
          list$="[[list]]"
          size$="[[size]]"
          autocapitalize$="[[autocapitalize]]"
          autocorrect$="[[autocorrect]]"
          on-click="testFunc">-->
          
      <paper-textarea id="foo" bind-value="{{value_short}}" label="{{value_short}}" rows="[[focus_rows]]" max-rows="4"></paper-textarea>
    </iron-a11y-keys>
  </template>
  <script>
  Polymer({
    is: "expandable-input",
    properties: {
      name: {stype: String},
      value: {type: String},
      value_short: {
        type: String,
        computed: 'shortenValue(value)',
        bind: 'focused' 
        },
      focus_rows: {
        type: Number,
        default: 1,
        }
    },
    behaviors: [
      Polymer.IronFormElementBehavior,
      Polymer.PaperInputBehavior,
      Polymer.IronControlState,
      Polymer.PaperInputBehaviorImpl
               ],
    ready: function() {
     console.log("ready, focus is:", this.focused);
     this.addEventListener('focused-changed', this.testFocus);
    },
    shortenValue: function(value) {
      //console.log(value.length);
      if (!this.focused){
        var field_len = 7;
        if (value.length > field_len){
          return value.substr(0,field_len)+'...';
        }
        else {
          return value;
        }
      }
      else {
        return value;
      }

    },
    testFocus: function(){
      console.log(this.value, ' in focus');
      if (this.focused){
        this.focus_rows=3;
        console.log(this.$.foo.offsetWidth);
      } else {
        this.focus_rows=1;
      }
    },
    submitForm: function(){
      //console.log('value', this.name);
      //this.focused = false;
      this.fire('iron-form-submit', [this.name, this.$.foo.value]);
    }
  });

  </script>
</dom-module>
